<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
  <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='images/favicon.jpeg') }}">
  <link href="../static/files/css/bootstrap.min.css" rel="stylesheet">
    <script src="../static/files/js/bootstrap.bundle.min.js"></script>
    <style>
        .rule-status {
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }
        .rule-muted {
            color: #6c757d;
        }
    </style>
</head>
<body>
     <div class="container">
         {% include 'navbar.html' %}
         <section class="row">
             <div class="col-md-4">
                  <h3>Create Account</h3>
                  <span style="color:green;">{{success}}</span>
                  <span style="color:red;">{{error}}</span>
                  <form action="/signup" method="post">
                      <input type="hidden" name="next" value="{{ next_url or '' }}">
                      <input type="text" name="username" placeholder="Your Username"
                      class="form-control {% if error_field in ['username','both'] %}is-invalid{% endif %}"> 
                      <div class="form-text">Username must be unique.</div>
                      {% if error_field in ['username','both'] %}
                      <div class="invalid-feedback d-block">This username is already taken.</div>
                      {% endif %}
                      <br>

                      <input type="email" name="email" placeholder="Your Email"
                      class="form-control {% if error_field in ['email','both'] %}is-invalid{% endif %}"> 
                      <div class="form-text">Use an email that hasn't been registered.</div>
                      {% if error_field in ['email','both'] %}
                      <div class="invalid-feedback d-block">This email is already registered.</div>
                      {% endif %}
                      <br>

                      <input type="tel" name="phone" placeholder="Your Phone"
                      class="form-control"> <br>

                      <input type="password" name="password1" placeholder="Your Password"
                      class="form-control" id="password1"> <br>

                      <input type="password" name="password2" placeholder="Confirm Password"
                      class="form-control"> <br> 

                      <div class="border rounded p-3 mb-3 bg-light" id="passwordRules" style="display:none;">
                          <strong>Your password must contain:</strong>
                          <ul class="mt-2 mb-0">
                              <li id="rule-length" class="rule-muted">
                                  At least 8 characters
                                  <span class="rule-status" id="status-length">Missing</span>
                              </li>
                              <li id="rule-categories" class="rule-muted">
                                  At least 3 of the following
                                  <span class="rule-status" id="status-categories">0/4</span>
                                  <ul>
                                      <li id="rule-lower" class="rule-muted">
                                          Lower case letters (a-z)
                                          <span class="rule-status" id="status-lower">Missing</span>
                                      </li>
                                      <li id="rule-upper" class="rule-muted">
                                          Upper case letters (A-Z)
                                          <span class="rule-status" id="status-upper">Missing</span>
                                      </li>
                                      <li id="rule-number" class="rule-muted">
                                          Numbers (0-9)
                                          <span class="rule-status" id="status-number">Missing</span>
                                      </li>
                                      <li id="rule-special" class="rule-muted">
                                          Special characters (e.g. !@#$%^&*)
                                          <span class="rule-status" id="status-special">Missing</span>
                                      </li>
                                  </ul>
                              </li>
                              <li id="rule-repeat" class="rule-muted">
                                  No more than 2 identical characters in a row
                                  <span class="rule-status" id="status-repeat">Missing</span>
                              </li>
                          </ul>
                      </div>

                      <div class="form-check mb-3">
                          <input class="form-check-input" type="checkbox" value="yes" id="humanVerify" name="humanVerify" required>
                          <label class="form-check-label" for="humanVerify">
                              I am human (click to verify)
                          </label>
                      </div>

                      <input type="submit" value="Sign Up" class="btn btn-info">
                 </form>
                 <br>
                 <a href="/signin"> Already Have an Account?, Login </a>
             </div>
         </section> 
     </div>

     <script>
         (function () {
             var passwordInput = document.getElementById("password1");
             var rulesBox = document.getElementById("passwordRules");
             if (!passwordInput || !rulesBox) {
                 return;
             }
             var rules = {
                 length: document.getElementById("rule-length"),
                 categories: document.getElementById("rule-categories"),
                 lower: document.getElementById("rule-lower"),
                 upper: document.getElementById("rule-upper"),
                 number: document.getElementById("rule-number"),
                 special: document.getElementById("rule-special"),
                 repeat: document.getElementById("rule-repeat")
             };

             var statuses = {
                 length: document.getElementById("status-length"),
                 categories: document.getElementById("status-categories"),
                 lower: document.getElementById("status-lower"),
                 upper: document.getElementById("status-upper"),
                 number: document.getElementById("status-number"),
                 special: document.getElementById("status-special"),
                 repeat: document.getElementById("status-repeat")
             };

             function setRuleState(ruleEl, statusEl, isValid, okText) {
                 if (!ruleEl || !statusEl) {
                     return;
                 }
                 if (isValid) {
                     ruleEl.classList.remove("rule-muted");
                     ruleEl.classList.add("text-success");
                     statusEl.textContent = okText || "OK";
                 } else {
                     ruleEl.classList.remove("text-success");
                     ruleEl.classList.add("rule-muted");
                     statusEl.textContent = okText || "Missing";
                 }
             }

             function updateRules() {
                 var value = passwordInput.value || "";
                 if (value.length > 0) {
                     rulesBox.style.display = "block";
                 } else {
                     rulesBox.style.display = "none";
                 }

                 var hasLower = /[a-z]/.test(value);
                 var hasUpper = /[A-Z]/.test(value);
                 var hasNumber = /[0-9]/.test(value);
                 var hasSpecial = /[^A-Za-z0-9]/.test(value);
                 var noTripleRepeat = !/(.)\1\1/.test(value);
                 var lengthOk = value.length >= 8;

                 var categoryCount = 0;
                 if (hasLower) categoryCount += 1;
                 if (hasUpper) categoryCount += 1;
                 if (hasNumber) categoryCount += 1;
                 if (hasSpecial) categoryCount += 1;
                 var categoriesOk = categoryCount >= 3;

                 setRuleState(rules.length, statuses.length, lengthOk);
                 setRuleState(rules.lower, statuses.lower, hasLower);
                 setRuleState(rules.upper, statuses.upper, hasUpper);
                 setRuleState(rules.number, statuses.number, hasNumber);
                 setRuleState(rules.special, statuses.special, hasSpecial);
                 setRuleState(rules.repeat, statuses.repeat, noTripleRepeat);
                 setRuleState(rules.categories, statuses.categories, categoriesOk, categoryCount + "/4");
             }

             passwordInput.addEventListener("input", updateRules);
             updateRules();
         })();
     </script>
</body>
</html>
